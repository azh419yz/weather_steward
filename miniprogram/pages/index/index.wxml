<!--index.wxml-->
<view class="weather-container">
  <!-- 下拉刷新组件 -->
  <ant-container refresher-enabled refresher-triggered="{{refreshing}}" bind:refresherpulling="onPulling" bind:refresherrefresh="onRefresh">
    <!-- 顶部城市栏 -->
    <view class="city-bar" bindtap="openCitySelector">
      <view class="city-name">{{currentCity}}</view>
      <ant-icon type="location" className="location-icon" />
    </view>
    
    <!-- 授权提示 -->
    <view class="auth-container" wx:if="{{!hasLocationAuth}}">
      <view class="auth-tip">需要获取您的位置才能提供准确的天气信息</view>
      <ant-button type="primary" onTap="requestLocationAuth">授权位置信息</ant-button>
    </view>
    
    <!-- 加载状态 -->
    <view class="loading-container" wx:elif="{{loading}}">
      <ant-icon type="loading" className="loading-icon" spin />
      <view class="loading-text">正在获取天气数据...</view>
    </view>
    
    <!-- 天气信息展示 -->
    <view class="weather-content" wx:else>
      <!-- 今日天气卡片 -->
      <ant-card title="今日天气" className="today-card">
        <view class="today-weather">
          <view class="weather-icon-large">
            <image src="{{weatherData[0].iconUrl}}" mode="aspectFit" />
          </view>
          <view class="today-info">
            <view class="weather-desc">{{weatherData[0].weather}}</view>
            <view class="temp-range">{{weatherData[0].temp}}</view>
            <view class="update-time">更新时间: {{updateTime}}</view>
          </view>
        </view>
      </ant-card>
      
      <!-- 未来天气预报 -->
      <view class="forecast-section">
        <view class="forecast-title">未来6天天气预报</view>
        <view class="forecast-list">
          <view class="forecast-item" wx:for="{{weatherData}}" wx:key="date" wx:if="{{index > 0}}">
            <view class="forecast-date">{{item.date}}</view>
            <image class="forecast-icon" src="{{item.iconUrl}}" mode="aspectFit" />
            <view class="forecast-weather">{{item.weather}}</view>
            <view class="forecast-temp">{{item.temp}}</view>
          </view>
        </view>
      </view>
    </view>
  </ant-container>
</view>
